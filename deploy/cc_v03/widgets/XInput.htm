<template id="x-input-template">
	<style>
		td,input{
			font-size:1.1em;
		}
		input{
			width:100%;
			text-align:right;
			border:1px solid lightgrey;
			padding: 2px;
		}
		input:invalid{
			color:red;
			background-color:lightyellow;
			border-style:solid;
			border-width:1px;
		}
		div{
			/*border:1px solid lightgrey;
			padding: 0 2px;
			margin:1px;*/
		}
		#error{
			display:none;
			margin:3px;
			color:darkred;
			background-color:lightyellow;
			//border: 1px solid red;
			//border-radius: 0.5em;			
		}
		#unit{
			width:3em;
			font-family: Palatino, serif;
		}
		table{
			border-spacing:0px;
			width:100%;
		}
		div:hover{
			background-color:#E6E6FF;
		}
		div{
			cursor:pointer;
			-webkit-user-select:none;
			border-radius:4px;
		}
		input[type=number]::-webkit-inner-spin-button,
		input[type=number]::-webkit-outer-spin-button {
			-webkit-appearance: none;
			margin: 0;
		}
	</style>
	<div>
		<table>
			<tr>
				<td id="name" colspan=3></td>
			</tr>
			<tr>
				<td id="notation" style="padding-right:0.5em;text-align:right;width:4em;"></td>
				<td style="padding-left:0.3em;text-align:right;width:5em;"><input type="text" required/></td>
				<td id="unit"></td>
			</tr>
			<tr>
				<td id="error" colspan=3>
					<p>A long and convoluted error message to teach people things</p>
					<p>Another longer and convoluted error message to teach people things</p>
				</td>
			</tr>
		</table>
	</div>
</template>





<script id="x-input-script">
var XInputPrototype = Object.create(HTMLDivElement.prototype);
XInputPrototype.createdCallback = function(){
	// ##########################################################################################
	// 			DEFERED CONSTRUCTOR
	// ##########################################################################################
	this.create = function(){
		//import content from the template element
		var imported = document.querySelector("#x-input-template").innerHTML;
		this.webkitCreateShadowRoot();
		this.webkitShadowRoot.innerHTML = imported;
		
		// ##########################################################################################
		// 			EVENT LISTENERS
		// ##########################################################################################
		this.input = this.webkitShadowRoot.querySelector("input");
		this.input.addEventListener("input",function(e){
			this.update();
			this.change();
		}.bind(this));
		this.input.addEventListener("change",function(e){
			this.update();
			this.change();
		}.bind(this));
		
		this.webkitShadowRoot.querySelector("div").addEventListener("mousedown",function(e){
			if(e.target!=this.input){
				e.preventDefault();
				this.input.focus();
			}
		}.bind(this))
		
		this.isvalid = function(thisval){return true;};
		
		this.getAttributes();
		MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.webkitShadowRoot]);
	}.bind(this); // end create();
	
	// ##########################################################################################
	// 			EVENT Dispatchers
	// ##########################################################################################
	this.update = function(e){
		var evt = new Event("update");
		evt.target = this;
		evt.bubbles = true;
		this.dispatchEvent(evt);
	}.bind(this);
	this.change = function(e){
		var evt = new Event("change");
		evt.target = this;
		evt.bubbles = true;
		this.dispatchEvent(evt);
	}.bind(this);
	
	
	// ##########################################################################################
	// 			Calibrate this input based on the value of its attributes
	// ##########################################################################################
	this.getAttributes = function(){
		for(var i=0; i<this.attributes.length;i++){
			var att = this.attributes[i];
			this[att.name] = att.value;
		}
	}.bind(this);
	
	this.setCustomValidity = function(str){
		this.webkitShadowRoot.querySelector("input").setCustomValidity(str);
	}.bind(this)
	
	
	// ##########################################################################################
	// 			GETTERS AND SETTERS
	// ##########################################################################################
	// VALUE
	Object.defineProperty(this,"value",{
		get:function(){
			// TODO: hunt down and fix all of this nonsense
			//console.warn("depricated");
			return this.input.value;
		}.bind(this),
		set:function(newval){
			//console.warn("depricated");
			this.input.value = newval;
		}.bind(this)
	});
	Object.defineProperty(this,"textValue",{
		get:function(){
			return this.input.value;
		}.bind(this),
		set:function(newval){
			this.input.value = newval;
		}.bind(this)
	});
	
	Object.defineProperty(this,"integerValue",{
		get:function(){
			return parseInt(this.input.value);
		}.bind(this),
		set:function(newval){
			this.input.value = newval;
		}.bind(this)
	});
	
	
	// VALID
	Object.defineProperty(this,"valid",{
		get:function(){
			this.isvalid(this.value);
		}
	});
	
	
	// VARNAME
	Object.defineProperty(this,"varname",{
		get:function(){
			return this.webkitShadowRoot.querySelector("#name").innerHTML;
		},
		set:function(newval){
			this.webkitShadowRoot.querySelector("#name").innerHTML = newval;
		}
	});
	
	
	// NOTATION
	Object.defineProperty(this,"notation",{
		get:function(){
			return this.webkitShadowRoot.querySelector("#notation").innerHTML;
		},
		set:function(newval){
			this.webkitShadowRoot.querySelector("#notation").innerHTML = newval;
		}
	});
	
	
	// UNIT
	Object.defineProperty(this,"unit",{
		get:function(){
			return this.webkitShadowRoot.querySelector("#unit").innerHTML;
		},
		set:function(newval){
			this.webkitShadowRoot.querySelector("#unit").innerHTML = newval;
		}
	});
	
	
	// PATTERN
	Object.defineProperty(this,"pattern",{
		get:function(){
			return this.input.pattern;
		},
		set:function(newval){
			this.input.pattern = newval;
		}
	});
	
	
	// TYPE
	Object.defineProperty(this,"type",{
		get:function(){
			return this.input.type;
		},
		set:function(newval){
			this.input.type = newval;
		}
	});
	
	
	// MIN
	Object.defineProperty(this,"min",{
		get:function(){
			return this.input.min;
		},
		set:function(newval){
			this.input.min = newval;
		}
	});
	
	
	// MAX
	Object.defineProperty(this,"max",{
		get:function(){
			return this.input.max;
		},
		set:function(newval){
			this.input.max = newval;
		}
	});
	
	
	// STEP
	Object.defineProperty(this,"step",{
		get:function(){
			return this.input.step;
		},
		set:function(newval){
			this.input.step = newval;
		}
	});
	
	
	// DATA-TOOLTIP
	Object.defineProperty(this,"data-tooltip",{
		get:function(){
			return this.webkitShadowRoot.querySelector("div").getAttribute("data-tooltip");
		},
		set:function(newval){
			this.webkitShadowRoot.querySelector("div").setAttribute("data-tooltip",newval);
		}
	});
	
	this.create();
}
var XInput = document.registerElement("x-input",{prototype:XInputPrototype});

</script>